
# HAWT BEM

Blade Element Method code for horizontal-axis wind turbines (HAWT) in MATLAB

## Basic Info

The **parallel computing toolbox** and **curve fitting toolbox** must be installed to run successfully

Blade element solver developed based on [QBlade](http://www.q-blade.de) code; computes force components and power output from a turbine.

**optimisation.m** Calculates the optimum turbine design, including blade number, tip-speed ratio, and twist and chord distributions. It exports a series of .csv files which can be imported to any CAD software, as well as a .stl surface.
*Note that the script currently only optimises for aerodynamic efficiency, which often results in structurally poor designs. A structures module is coming soon.*

**run.m** Runs BEM analysis on a single blade, without changing parameters. Generates useful data and plots, and can be used to generate .csv and .stl files.

**F360** Fusion360 API add-in for importing .csv files generated by MATLAB, using a loft.

## How To

### Optimisation

1. Set input variables appropriately (see comments in file)

    - elem can affect convergence if it is too low; values between 25 and 50 seem to work best
    - Note that tMax limits time for only come optimisation sections
    - foils.N must be equal to the number of items in foils.files and foils.plots
    - foils.files must be a character array of the aerofoil polar filenames (.dat)
    - foils.plots must be a character array of the aerofoil geometry filenames (.txt)

    - *The aerofoil polars (foils.files) must be of the format  | aoa | Cl | Cd |  with angles of attack between -180 and + 180 degrees where possible. Polars with a smaller range of angles than this may lead to errors. If multiple polars are defined, they **must** be of the same length to avoid errors*
    - *The aerofoil geometry (foils.plots) must be of the Selig format (see [airfoiltools](http://www.airfoiltools.com)); it can be useful if the files each contain the same number of points*
    - *Note that choice of 'delta' can have an affect on convergence for some optimisation functions.*
    - '*QBladeAerofoil.dat' and 'SG6043.txt' are sample files using the SG6043 aerofoil.*
 
2. Start a parallel computing pool (this requires the parallel computing toolbox). You will also need to curve fitting toolbox

3. Run the program

4. After some time, you will be asked if you wish to run a 'user-defined optimisation'. This gives the user additional control over B, lambda, and aoaDes; however, this code has not been 'user-proofed', so errors may be likely. Unless you specifically need this feature, it is recommended that it is skipped.

5. You will be asked to confirm before the blade geometry is generated.

6. Blade geometry is saved as a directory of .csv files, and a .stl file. The .csv files are named *z-coordinate*_.csv and can be imported to Fusion360 using the included API script.

7. After completion, the 'result' structure contains data for the optimised blade, including distributions of chord, twist, and forces.

**run.m** follows the same workflow as **optimisation.m**, although does not include optimisation functions, and generates different plots as a result. It is recommended that a design is optimised first, and then investigated further using **run.m**

### F360

1. Follow instructions at [autodesk](https://knowledge.autodesk.com/support/fusion-360/troubleshooting/caas/sfdcarticles/sfdcarticles/How-to-install-an-ADD-IN-and-Script-in-Fusion-360.html) to add the Fusion360 function
2. Open a new Fusion360 file, go to tools > add-ins and run 'Aerofoils-Blade-File'
3. Select the directory containing the .csv files generated by MATLAB, and open it
4. Fusion360 generates sketches for each profile, and attempts to generate a loft. You may need to redefine the loft profiles (see Known Bugs)

***

### Known Bugs

**Fusion360 API** fails to correctly order loft surfaces. The loft generation may return an error, although the sketches remain in place. The user can either re-order the loft surfaces manually, or delete the loft and generate a new one by selecting the profiles in the correct order.

Sketches in the **Fusion360 API** fail to import at the origin. They can be moved after importing.

